<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGL 2026 - Calendario</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Russo+One&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Ajuste Logo NBL más grande */
        .nbl-endorsement img {
            height: 60px !important;
            width: auto;
        }

        /* Botones de Redes Sociales */
        .social-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #111;
            border: 1px solid #333;
            color: #aaa;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .social-btn:hover {
            transform: translateY(-3px);
            border-color: var(--accent-cyan);
            color: white;
            box-shadow: 0 0 15px rgba(0, 242, 234, 0.4);
        }

        .social-btn svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
        }

        .social-btn.tiktok:hover {
            background: #000;
            border-color: var(--accent-cyan);
            color: #ff0050;
        }

        .social-btn.fb:hover {
            background: #1877f2;
            border-color: #1877f2;
            color: white;
        }

        .social-btn.insta:hover {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            border-color: #dc2743;
            color: white;
        }

        /* --- MONTH LIST VIEW (REEMPLAZO DEL CALENDARIO) --- */

        .cal-month-header {
            max-width: 1200px;
            margin: 0 auto 18px auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 18px;
            border: 1px solid #333;
            border-radius: 12px;
            background: linear-gradient(90deg, rgba(26, 11, 46, 0.9), rgba(0, 0, 0, 0.9));
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.35);
        }

        .cal-month-sub {
            margin-top: 6px;
            font-size: 0.85rem;
            color: #888;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-family: 'Russo One', sans-serif;
        }

        .month-title {
            font-family: 'Black Ops One', cursive;
            font-size: 2rem;
            color: white;
            text-transform: uppercase;
            margin: 0;
            text-shadow: 0 0 10px rgba(106, 27, 154, 0.5);
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .nav-btn:hover {
            background: var(--accent-cyan);
            color: black;
            box-shadow: 0 0 15px var(--accent-cyan);
        }

        .cal-layout {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .cal-list {
            background: rgba(0, 0, 0, 0.15);
            border: 1px solid #222;
            border-radius: 12px;
            padding: 12px;
            min-height: 400px;

            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .cal-card {
            background: #050505;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.25);

            display: flex;
            flex-direction: column;
        }

        .cal-card-top {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: baseline;
        }

        .cal-card-title {
            margin: 0;
            font-family: 'Russo One', sans-serif;
            color: white;
            text-transform: uppercase;
            font-size: 1rem;
            line-height: 1.2;
        }

        .cal-card-date {
            font-family: monospace;
            color: #f3f3f3;
            font-size: 0.85rem;
            white-space: nowrap;

            background: rgba(0, 0, 0, 0.65);
            border: 1px solid #2a2a2a;
            padding: 6px 10px;
            border-radius: 999px;
        }

        .cal-card-meta {
            margin-top: 8px;
            color: #d0d0d0;
            font-size: 0.9rem;
        }

        .cal-card-location {
            margin-top: 6px;
            color: #a9a9a9;
            font-size: 0.85rem;
            line-height: 1.2;
        }

        .cal-card-img-wrap {
            width: 100%;
            height: 240px;
            margin-top: 12px;
            border-radius: 10px;
            background: #080808;
            border: 1px solid #222;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cal-card-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            opacity: 0.95;
            transform: scale(1);
            transform-origin: center;
        }

        /* Escalar solo ciertos tipos para que se vean más grandes */
       
        .cal-card-img-wrap--reto .cal-card-img,
        .cal-card-img-wrap--copa .cal-card-img {
            transform: scale(1.35);
        }

        .cal-card-img-wrap--reto .cal-card-img,
        .cal-card-img-wrap--copa .cal-card-img {
            transform: scale(1.70);
        }

        .cal-card-img-wrap--chill .cal-card-img {
            transform: scale(1.25);
        }
        
         .cal-card-img-wrap--local .cal-card-img {
            transform: scale(1.45);
         }

        .cal-card-actions {
            margin-top: auto;
            padding-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .cal-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: 1px solid #333;
            color: white;
            padding: 8px 10px;
            border-radius: 10px;
            font-family: 'Russo One', sans-serif;
            font-size: 0.75rem;
            text-transform: uppercase;
            text-decoration: none;
            cursor: pointer;
            transition: 0.2s;
        }

        .cal-link.primary {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .cal-link:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 12px rgba(0, 242, 234, 0.12);
        }

        .cal-empty {
            padding: 16px;
            border: 1px dashed #333;
            border-radius: 12px;
            color: #777;
            text-align: center;
            font-style: italic;
            font-size: 0.95rem;
        }

        .cal-empty.big {
            padding: 22px;
            font-size: 1.05rem;
        }


        /* --- MODAL FLYER (CENTRADO + RESPONSIVE) --- */

        .modal-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 18px;
            background: rgba(0, 0, 0, 0.82);
            z-index: 9999;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            position: relative;
            width: min(92vw, 560px);
            max-height: calc(100vh - 36px);
            overflow: auto;
            padding: 14px;
            border-radius: 14px;
            border: 1px solid #222;
            background: #050505;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 38px;
            height: 38px;
            border-radius: 999px;
            border: 1px solid #333;
            background: rgba(0, 0, 0, 0.55);
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 12px rgba(0, 242, 234, 0.15);
        }

        .flyer-image {
            width: 100%;
            height: auto;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 12px;
            border: 1px solid #222;
            background: #0a0a0a;
        }

        .modal-location-box {
            margin-top: 14px;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.35);
        }

        .location-text {
            margin: 8px 0 12px 0;
            color: #cfcfcf;
            line-height: 1.2;
        }

        @media (min-width: 768px) {
            .cal-list {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (min-width: 1200px) {
            .cal-list {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }

        @media (max-width: 768px) {
            .cal-month-header {
                padding: 14px;
            }

            .month-title {
                font-size: 1.5rem;
            }

            .cal-card {
                padding: 12px;
            }

            .cal-card-title {
                font-size: 0.95rem;
            }

            .cal-card-img-wrap {
                height: 280px;
            }

            .modal-overlay {
                padding: 12px;
            }

            .modal-content {
                width: 94vw;
                max-height: calc(100vh - 24px);
                padding: 12px;
            }

            .flyer-image {
                max-height: 66vh;
            }
        }

        .cal-day-badge {
            background: #6a1b9a;
            color: white;
            font-family: 'Russo One', sans-serif;
            /* Cambiado a Russo para mejor legibilidad con letras */
            font-size: 1rem;
            /* Un poco más pequeño para que quepa bien el mes */
            padding: 6px 10px;
            border-radius: 8px;
            min-width: 65px;
            /* Más ancho para el formato DD/Mes */
            text-align: center;
            border: 1px solid #9c4dcc;
            box-shadow: 0 0 10px rgba(106, 27, 154, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            text-transform: uppercase;
        }

        /* Ajuste del contenedor del título para que el badge luzca bien */
        .cal-card-top {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            align-items: center;
            /* Alineado al centro para que el badge resalte */
            margin-bottom: 5px;
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <nav class="main-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="SGL.png" alt="Logo SGL" class="sgl-logo sgl-logo--nav">
                SGL <span>2026</span>
            </a>
            <button id="nav-toggle" class="nav-toggle" aria-label="Abrir menú" aria-expanded="false"
                aria-controls="nav-links">
                <i data-lucide="menu"></i>
            </button>
            <ul class="nav-links" id="nav-links">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="rankings.html">Ranking</a></li>
                <li><a href="reglas.html">Reglas</a></li>
                <li><a href="calendario.html" class="active">Calendario</a></li>
            </ul>
        </div>
    </nav>

    <div class="content-wrapper">
        <div class="section-title">
            CALENDARIO DE EVENTOS
            <span style="font-size:0.8rem; font-family:'Roboto'; color:#666;">TEMPORADA 2026</span>
        </div>

        <div class="cal-month-header">
            <button class="nav-btn" id="btnPrevMonth" aria-label="Mes anterior"><i
                    data-lucide="chevron-left"></i></button>
            <div>
                <h2 class="month-title" id="currentMonthDisplay">ENERO 2026</h2>
                <div class="cal-month-sub">Selecciona un mes para ver los eventos</div>
            </div>
            <button class="nav-btn" id="btnNextMonth" aria-label="Mes siguiente"><i
                    data-lucide="chevron-right"></i></button>
        </div>

        <div class="cal-layout">
            <section class="cal-list" id="monthEvents">
                <div class="cal-empty">Cargando eventos...</div>
            </section>
        </div>
    </div>

    <div id="flyer-modal" class="modal-overlay" onclick="closeFlyer(event)">
        <div class="modal-content">
            <button class="close-modal" onclick="closeFlyer(event)">X</button>

            <img id="modal-img" src="" alt="Flyer del Torneo" class="flyer-image">

            <div class="modal-location-box">
                <div class="location-title" style="color: var(--accent-cyan);">UBICACIÓN</div>
                <p id="modal-location-text" class="location-text">Cargando ubicación...</p>

                <a id="modal-map-btn" href="#" target="_blank" class="btn-map"
                    style="border-color: var(--primary-purple);">
                    <i data-lucide="map-pin"></i> VER EN GOOGLE MAPS
                </a>
            </div>
        </div>
    </div>

    <footer
        style="text-align:center; padding: 40px 20px; color: #444; font-size: 0.8rem; background: #080808; border-top: 1px solid #222;">

        <div style="margin-bottom: 20px;">
            <p style="color: var(--accent-cyan); font-family: 'Russo One'; margin-bottom: 15px; font-size: 0.9rem;">
                SÍGUENOS EN</p>
            <div class="social-bar">
                <a href="https://www.tiktok.com/@m.fama.league.nbl" target="_blank" class="social-btn tiktok"
                    title="TikTok">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z" />
                    </svg>
                </a>

                <a href="https://www.facebook.com/m.famaleague" target="_blank" class="social-btn fb" title="Facebook">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" />
                    </svg>
                </a>

                <a href="https://www.instagram.com/m.famaleagueqro" target="_blank" class="social-btn insta"
                    title="Instagram">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                    </svg>
                </a>
            </div>
        </div>

        <p>SMASH GOATS LEAGUE 2026<br>
            <span style="font-size: 0.7rem; color: #666;">Afiliada a Night Blade League (NBL)</span>
        </p>
    </footer>

    <script>
        lucide.createIcons();

        // --- DATA ---
        const eventos = [
            // --- ENERO ---
            {
                fecha: '2026-01-04',
                titulo: 'TORNEO MINOR PAREJAS',
                tipo: 'MINOR',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'FINALIZADO',
                flyer: '04-enero-2026.png',
                ubicacion: 'Arlequín - Plaza Quintanal, Local 31',
                mapa: 'https://maps.app.goo.gl/pwQcajpqQXnUoZP3A?g_st=aw'
            },
            {
                fecha: '2026-01-11',
                titulo: 'TORNEO LOCAL',
                tipo: 'LOCAL',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'FINALIZADO',
                flyer: '11-enero-2026.jpeg',
                ubicacion: 'Arlequín - Plaza Quintanal, Local 31',
                mapa: 'https://maps.app.goo.gl/pwQcajpqQXnUoZP3A?g_st=aw'
            },
            {
                fecha: '2026-01-18',
                titulo: 'TORNEO RETO DE LIGA',
                tipo: 'RETO',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'FINALIZADO',
                flyer: '18-enero-2026.png',
                ubicacion: 'Arlequín - Plaza Quintanal, Local 31',
                mapa: 'https://maps.app.goo.gl/pwQcajpqQXnUoZP3A?g_st=aw'
            },
            {
                fecha: '2026-01-24',
                titulo: 'TORNEO DE CHILL',
                tipo: 'CHILL',
                sede: 'Arlequín',
                formato: 'Por definir',
                estado: 'FINALIZADO',
                flyer: '24-enero-2026.jpg',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-01-25',
                titulo: 'TORNEO LOCAL',
                tipo: 'LOCAL',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'FINALIZADO',
                flyer: '25-enero-2026.jpg',
                ubicacion: 'Arlequín - Plaza Quintanal, Local 31',
                mapa: 'https://maps.app.goo.gl/pwQcajpqQXnUoZP3A?g_st=aw'
            },

            // --- FEBRERO (En Plaza Alameda) ---
            {
                fecha: '2026-02-01',
                titulo: 'DUPLAS O TERCIAS CHILL',
                tipo: 'CHILL',
                sede: 'Arlequín',
                formato: 'NO RANKED',
                estado: 'PRÓXIMO',
                flyer: '01-febrero-2026.jpeg',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-02-08',
                titulo: 'DINÁMICO RANKED',
                tipo: 'MINOR',
                sede: 'Arlequín',
                formato: 'Dinámico',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-02-15',
                titulo: 'COPA 3G',
                tipo: 'COPA',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-02-22',
                titulo: 'RANKED 3G LOCAL',
                tipo: 'LOCAL',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },

            // --- MARZO (En Plaza Alameda) ---
            {
                fecha: '2026-03-01',
                titulo: 'TERCIAS O DUPLAS CHILL',
                tipo: 'CHILL',
                sede: 'Arlequín',
                formato: 'NO RANKED',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-03-08',
                titulo: '3G RETO LIGA',
                tipo: 'RETO',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-03-15',
                titulo: 'DINÁMICA RANKED',
                tipo: 'MINOR',
                sede: 'Arlequín',
                formato: 'Dinámico',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            },
            {
                fecha: '2026-03-22',
                titulo: '3G RANKED LOCAL',
                tipo: 'LOCAL',
                sede: 'Arlequín',
                formato: '3G',
                estado: 'PRÓXIMO',
                flyer: 'default.png',
                ubicacion: 'Arlequín - Plaza Alameda',
                mapa: 'https://maps.app.goo.gl/o5qQzom2U7u1C8yQ7'
            }
        ];

        function formatShortDate(iso) {
            const [y, mStr, d] = iso.split('-');
            const meses = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];
            const mIndex = parseInt(mStr, 10) - 1;
            return `${d}/${meses[mIndex]}`; // Retorna formato 04/Ene
        }

        function parseISOToDate(iso) {
            const [y, m, d] = iso.split('-').map(n => parseInt(n, 10));
            return new Date(y, m - 1, d);
        }

        function monthKeyFromDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            return `${y}-${m}`;
        }

        function formatMonthTitle(key) {
            const [y, mStr] = key.split('-');
            const m = parseInt(mStr, 10) - 1;
            const monthNames = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
            return `${monthNames[m]} ${y}`;
        }

        function getTypeImage(tipo) {
            const info = getEventTypeInfo(tipo);
            return info.img || '';
        }

        let currentMonthKey = null;

        function getAllMonthKeys() {
            const keys = eventos
                .map(e => monthKeyFromDate(parseISOToDate(e.fecha)))
                .sort();
            return [...new Set(keys)];
        }

        function shiftMonthKey(key, delta) {
            const [yStr, mStr] = key.split('-');
            const d = new Date(parseInt(yStr, 10), parseInt(mStr, 10) - 1, 1);
            d.setMonth(d.getMonth() + delta);
            return monthKeyFromDate(d);
        }

        function renderMonthList() {
            const titleEl = document.getElementById('currentMonthDisplay');
            const listEl = document.getElementById('monthEvents');

            if (!titleEl || !listEl) return;
            if (!currentMonthKey) currentMonthKey = getAllMonthKeys()[0] || monthKeyFromDate(new Date());

            titleEl.textContent = formatMonthTitle(currentMonthKey);

            const monthEvents = eventos
                .filter(e => monthKeyFromDate(parseISOToDate(e.fecha)) === currentMonthKey)
                .sort((a, b) => a.fecha.localeCompare(b.fecha));

            if (monthEvents.length === 0) {
                listEl.innerHTML = '<div class="cal-empty big">No hay eventos programados para este mes.</div>';
                return;
            }

            listEl.innerHTML = monthEvents.map(ev => {
                const safeFlyer = (ev.flyer || '').replace(/'/g, "\\'");
                const safeUbic = (ev.ubicacion || '').replace(/'/g, "\\'");
                const safeMapa = (ev.mapa || '').replace(/'/g, "\\'");
                const typeInfo = getEventTypeInfo(ev.tipo);
                const typeImg = typeInfo.img || '';
                const typeKey = typeInfo.key || 'default';

                return `
        <article class="cal-card">
            <div class="cal-card-top">
                <h3 class="cal-card-title">${ev.titulo}</h3>
                <div class="cal-day-badge">${formatShortDate(ev.fecha)}</div>
            </div>
            <div class="cal-card-meta">${ev.sede} | ${ev.formato} ${ev.estado ? `| ${ev.estado}` : ''}</div>
            ${ev.ubicacion ? `<div class="cal-card-location">${ev.ubicacion}</div>` : ''}
            ${typeImg ? `
                <div class="cal-card-img-wrap cal-card-img-wrap--${typeKey}">
                    <img class="cal-card-img" src="${typeImg}" alt="Tipo de torneo" onerror="this.parentNode && this.parentNode.remove()">
                </div>
            ` : ''}
            <div class="cal-card-actions">
                <button class="cal-link primary" onclick="openFlyer('${safeFlyer}', '${safeUbic}', '${safeMapa}')">
                    <i data-lucide="image"></i> Ver flyer
                </button>
                <a class="cal-link" href="${ev.mapa || 'https://maps.google.com'}" target="_blank" rel="noopener">
                    <i data-lucide="map-pin"></i> Mapa
                </a>
            </div>
        </article>
    `;
            }).join('');

            if (window.lucide && window.lucide.createIcons) {
                window.lucide.createIcons();
            }
        }

        function getEventTypeInfo(tipo) {
            const t = (tipo || '').toUpperCase();

            // Imágenes de tipo esperadas en la raíz del sitio:
            // minor.png, local.png, reto.png, copa.png, chill.png
            // Nota: si falta el archivo, la imagen se oculta automáticamente (onerror -> remove).

            if (t.includes('MINOR')) return { key: 'minor', label: 'Minor', img: 'minor.png' };
            if (t.includes('LOCAL')) return { key: 'local', label: 'Local', img: 'local.png' };
            if (t.includes('RETO')) return { key: 'reto', label: 'Reto de Liga', img: 'reto.png' };
            if (t.includes('COPA')) return { key: 'copa', label: 'Copa', img: 'copa.png' };
            if (t.includes('CHILL')) return { key: 'chill', label: 'Chill', img: 'chill.png' };

            return { key: 'default', label: 'Torneo', img: '' };
        }

        function initCalendar() {
            const keys = getAllMonthKeys();
            currentMonthKey = keys[0] || monthKeyFromDate(new Date());

            const prevBtn = document.getElementById('btnPrevMonth');
            const nextBtn = document.getElementById('btnNextMonth');

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    currentMonthKey = shiftMonthKey(currentMonthKey, -1);
                    renderMonthList();
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    currentMonthKey = shiftMonthKey(currentMonthKey, 1);
                    renderMonthList();
                });
            }

            renderMonthList();
        }

        // --- MODAL LOGIC (Preserved) ---
        function openFlyer(imageName, locationName, mapUrl) {
            const modal = document.getElementById('flyer-modal');
            const img = document.getElementById('modal-img');
            const locText = document.getElementById('modal-location-text');
            const mapBtn = document.getElementById('modal-map-btn');

            img.src = 'flayers-torneos/' + imageName;

            img.onerror = function () {
                this.src = 'https://via.placeholder.com/500x600?text=No+Flyer+Available';
            };

            locText.innerText = locationName;
            mapBtn.href = mapUrl || 'https://maps.google.com';

            modal.classList.add('active');
        }

        function closeFlyer(e) {
            if (e.target.classList.contains('modal-overlay') || e.target.classList.contains('close-modal')) {
                document.getElementById('flyer-modal').classList.remove('active');
                setTimeout(() => { document.getElementById('modal-img').src = ''; }, 300);
            }
        }

        // Init
        document.addEventListener('DOMContentLoaded', initCalendar);

        // Mobile nav toggle
        (function () {
            const nav = document.querySelector('.main-nav');
            const btn = document.getElementById('nav-toggle');
            if (!nav || !btn) return;

            btn.addEventListener('click', () => {
                const isOpen = nav.classList.toggle('is-open');
                btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            });

            nav.querySelectorAll('.nav-links a').forEach(a => {
                a.addEventListener('click', () => {
                    if (!nav.classList.contains('is-open')) return;
                    nav.classList.remove('is-open');
                    btn.setAttribute('aria-expanded', 'false');
                });
            });
        })();

    </script>
</body>

</html>